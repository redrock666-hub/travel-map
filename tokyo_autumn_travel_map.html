<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±äº¬æ¶¼ç§‹äº«ä¸‰æ¹¯äº”æ—¥éŠåœ°åœ–</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- Leaflet Mouse Position æ’ä»¶çš„ CSS æ–‡ä»¶ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-mouse-position/0.4.0/L.Control.MousePosition.css" />
    <style>
        /* è¨­å®šåœ°åœ–å®¹å™¨æ¨£å¼ */
        #map {
            height: 100vh;
            width: 100vw;
            border: 0px solid transparent;
            outline: none;
            position: relative;
        }
        /* è‡ªè¨‚å½ˆå‡ºè¦–çª—æ¨£å¼ */
        .custom-popup .leaflet-popup-content-wrapper {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .custom-popup .leaflet-popup-content {
            margin: 10px;
        }
        .custom-popup .leaflet-popup-header {
            font-size: 1.2em;
            color: #0078d7;
            margin-bottom: 5px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        .custom-popup .scene-note-content {
            font-size: 15px; 
            line-height: 1.6;
            color: #333;
            margin-bottom: 8px;
        }
        .custom-popup .itinerary-content {
            font-size: 14px; 
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap;
        }
        .leaflet-control-container .leaflet-top,
        .leaflet-control-container .leaflet-bottom { z-index: 1000; }
        .leaflet-control-zoom { margin-top: 10px; }
        .leaflet-control-scale { margin-bottom: 10px; }
        .leaflet-control-mouseposition { margin-left: 10px; }

        /* æ¨™è¨˜æ¨£å¼ */
        .my-div-icon {
            border-radius: 50%;
            color: #fff;
            font-size: 60px;
            width: 70px;
            height: 70px;
            line-height: 70px;
            text-align: center;
            border: 3px solid #fff;
            box-shadow: 0 0 15px rgba(0,0,0,0.8);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .my-div-icon:hover { transform: scale(1.4); box-shadow: 0 0 30px rgba(0,0,0,0.9); }
        .my-div-icon span { color: #00ffff; }
        .my-div-icon .emoji-label { font-size: 35px; line-height: 70px; text-shadow: none; }

        /* æ—¥åˆ¥é¡è‰² */
        .day-1-icon { background-color: #2e8b57; }
        .day-2-icon { background-color: #d62828; }
        .day-3-icon { background-color: #f77f00; }
        .day-4-icon { background-color: #fcbf49; }
        .day-5-icon { background-color: #555555; }

        /* å°èˆªæ§åˆ¶é … */
        .nav-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 10px; /* ç¸®å°é–“è·ä»¥å®¹ç´æ–°æŒ‰éˆ• */
            background: rgba(0, 120, 215, 0.9);
            padding: 10px 15px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .nav-controls button {
            border: none; padding: 10px 15px; border-radius: 10px;
            font-size: 16px; font-weight: bold; cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            width: 50px; height: 50px; line-height: 50px; padding: 0;
            display: flex; justify-content: center; align-items: center;
        }
        .nav-controls .scene-button {
            background-color: #fff; color: #0078d7; font-size: 24px;
        }
        .nav-controls .scene-button:hover { background-color: #e6e6e6; color: #005bb5; }
        .nav-controls .all-button {
            background-color: #ffd700; color: #333; font-size: 18px; line-height: normal; /* è®“æ–‡å­—ç½®ä¸­ */
        }
        .nav-controls .all-button:hover { background-color: #e5c500; color: #000; }
        .nav-controls .hotel-button {
            background-color: #a453ff; color: #fff; font-size: 24px;
        }
        .nav-controls .hotel-button:hover { background-color: #8c3bcc; }
        .nav-controls button:active { transform: scale(0.95); }

        /* é£¯åº—æ¸…å–®æ¨¡æ…‹å½ˆçª— (Modal) æ¨£å¼ */
        .modal {
            display: none; /* é è¨­éš±è— */
            position: fixed; 
            z-index: 2000; 
            left: 0; top: 0;
            width: 100%; height: 100%;
            overflow: auto; 
            background-color: rgba(0,0,0,0.7); 
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto; /* å‚ç›´ç½®ä¸­ï¼Œä¸Šé‚Šè· 10% */
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            width: 90%; 
            /* èª¿æ•´ max-width è®“å½ˆçª—è®Šçª„ */
            max-width: 400px; 
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        .modal-content h2 {
            color: #0078d7; border-bottom: 2px solid #0078d7; padding-bottom: 10px; margin-top: 0;
        }
        /* èª¿æ•´ h3 æ¨£å¼ä»¥é©æ‡‰åˆä½µå¾Œçš„æ¨™é¡Œ */
        .modal-content h3 {
            color: #555; margin-top: 15px; margin-bottom: 10px; /* å¢åŠ åº•éƒ¨é–“è· */
            font-size: 1.1em;
            border-left: 4px solid #a453ff; padding-left: 10px;
        }
        .close-button {
            color: #aaa; float: right; font-size: 28px; font-weight: bold;
            position: absolute; top: 10px; right: 15px;
        }
        .close-button:hover,
        .close-button:focus {
            color: #000; text-decoration: none; cursor: pointer;
        }
        /* ç§»é™¤ hotel-name-header çš„æ¨£å¼ï¼Œå› ç‚ºå®ƒå°‡è¢« h3 å–ä»£ */
        /* .hotel-name-header {
            color: #333; margin: 5px 0 10px 0; font-size: 1.1em;
            font-weight: 600;
        } */
        .button-group {
            display: flex;
            flex-direction: column; /* é è¨­ç‚ºå‚ç›´å †ç–Š */
            gap: 8px;
        }
        .hotel-link-button {
            width: 100%; background-color: #e9f5ff; color: #333; border: 1px solid #ccc;
            margin-bottom: 0px; /* ç§»é™¤åŸæœ¬çš„ margin-bottom */
            text-align: center; padding: 10px 15px; font-size: 15px;
            border-radius: 8px; transition: background-color 0.2s, border-color 0.2s;
            box-shadow: none !important;
            font-weight: 500;
        }
        /* æœå°‹æŒ‰éˆ•æ¨£å¼ */
        .hotel-search-button {
            background-color: #e9f5ff;
            color: #0078d7;
            border: 1px solid #0078d7;
        }
        .hotel-search-button:hover {
            background-color: #d1e5ff;
        }
        /* é¡¯ç¤ºé£¯åº—æŒ‰éˆ•æ¨£å¼ */
        .hotel-show-button {
            background-color: #a453ff;
            color: #fff;
            border: 1px solid #a453ff;
        }
        .hotel-show-button:hover {
            background-color: #8c3bcc;
        }

        /* åœ¨æ¡Œé¢/å¹³æ¿ä¸Šæ©«å‘é¡¯ç¤ºæŒ‰éˆ• */
        @media (min-width: 400px) {
             .button-group {
                flex-direction: row; /* å¯¬å±ä¸‹æ©«å‘æ’åˆ— */
                justify-content: space-between;
            }
            .hotel-link-button {
                width: calc(50% - 4px); /* å¯¬åº¦ä½”ä¸€åŠï¼Œæ¸›å»é–“è· */
            }
        }
        /* åˆ†éš”ç·š */
        .hotel-item-container + hr {
            margin-top: 15px;
            margin-bottom: 15px;
            border: 0;
            border-top: 1px solid #eee;
        }


        /* é‡å°å°è¢å¹•èª¿æ•´æ¨¡æ…‹æ¡† */
        @media (max-width: 600px) {
            .modal-content { margin: 5% auto; width: 95%; }
            .nav-controls button { width: 45px; height: 45px; font-size: 20px; }
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- å°èˆªæ§åˆ¶é … -->
    <div class="nav-controls">
        <button id="prev-scene-button" class="scene-button" title="ä¸Šä¸€å€‹æ™¯é»">&#9664;</button>
        <button id="show-all-button" class="all-button" title="é¡¯ç¤ºæ‰€æœ‰æ™¯é»">å…¨</button>
        <!-- æ–°å¢é£¯åº—æ¸…å–®æŒ‰éˆ• -->
        <button id="hotel-list-button" class="hotel-button" title="é£¯åº—æ¸…å–®åŠå‘¨é‚Šæœå°‹">&#127976;</button>
        <button id="next-scene-button" class="scene-button" title="ä¸‹ä¸€å€‹æ™¯é»">&#9654;</button>
    </div>

    <!-- é£¯åº—æ¸…å–®æ¨¡æ…‹å½ˆçª— -->
    <div id="hotel-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeHotelListModal()">&times;</span>
            <h2>ğŸ¨ è¡Œç¨‹ä½å®¿é»æ¸…å–®</h2>
            <div id="hotel-list-content">
                <!-- é£¯åº—æ¸…å–®å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
            </div>
            <!-- æ›´æ–°èªªæ˜æ–‡å­—: é å·¦å°é½Šä¸¦åŠ ä¸Šç½²å -->
            <p style="font-size: 14px; color: #333; margin-top: 20px; text-align: left;">é»æ“Š **ğŸ”** æœå°‹å‘¨é‚Šç¾é£Ÿ (Googleåœ°åœ–)ï¼Œé»æ“Š **ğŸ“** å¯åœ¨ Google åœ°åœ–ä¸Šå®šä½é£¯åº—ã€‚..ã€å±±è£¡å¯èƒ½æ‰¾ä¸åˆ°è¶…å¸‚å–”! byå”å¤.è‹±è¯ã€‘</p>			
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Leaflet Mouse Position æ’ä»¶çš„ JS æ–‡ä»¶ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-mouse-position/0.4.0/L.Control.MousePosition.min.js"></script>
    <script>
        // åˆå§‹åŒ–åœ°åœ–
        var map = L.map('map').setView([35.6895, 139.6917], 7);

        // === å¯èª¿æ•´ï¼šåº•éƒ¨å®‰å…¨è·é›¢ï¼ˆåƒç´ ï¼‰ ===
        const BOTTOM_SAFE_MARGIN = 200;

        // åœ–ç£š (ä½¿ç”¨ OpenStreetMap ä½œç‚ºåº•åœ–)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // å®Œæ•´çš„è¡Œç¨‹è³‡è¨Š (ä¿æŒä¸è®Š)
        const fullItineraries = {
            1: `ğŸ—“ ç¬¬ 1 å¤©ï½œ11/12ï¼ˆä¸‰ï¼‰ æ¡ƒåœ’ âœˆ æˆç”° â†’ æ±äº¬æ¹¯æ¨‚åŸ<br>â—æ—©ä¸Šï¼šé›†åˆæ–¼æ¡ƒåœ’æ©Ÿå ´ï¼Œå°ˆäººè¾¦ç†ç™»æ©Ÿæ‰‹çºŒ<br>â—ä¸­åˆï¼šåœ‹æ³° CX450 (12:50 â†’ 16:50)ï¼Œæ©Ÿä¸Šäº«ç”¨å¥—é¤<br>â—ä¸‹åˆï¼šæŠµé”æˆç”° â†’ ã€æ±äº¬æ¹¯æ¨‚åŸã€‘æº«æ³‰ä¸»é¡Œæ¨‚åœ’ï¼ˆå²©ç›¤æµ´ã€è¡—æ™¯ã€è²å…‰ç§€ï¼‰<br>â—æ™šä¸Šï¼šåœ’å€è‡ªç”±è¦“é£Ÿï¼ˆè‡ªç†ï¼‰ â†’ å…¥ä½æ¹¯æ¨‚åŸåœ‹éš›æ¸¡å‡é…’åº—`,
            2: `ğŸ—“ ç¬¬ 2 å¤©ï½œ11/13ï¼ˆå››ï¼‰ æ±Ÿä¹‹å³¶é›»è»Š â†’ éŒå€‰é«˜æ ¡å‰ â†’ ç®±æ ¹ç¥ç¤¾ â†’ æ–°å€‰å±±æ·ºé–“å…¬åœ’<br>â—æ—©ä¸Šï¼šé£¯åº—æ—©é¤ â†’ æ¹˜å—æµ·å²¸ã€æ±Ÿä¹‹å³¶é›»è»Šé«”é©—ã€‘ã€éŒå€‰é«˜æ ¡å‰ï¼ˆçŒç±ƒé«˜æ‰‹æ‰“å¡ï¼‰<br>â—ä¸­åˆï¼šäº«ç”¨æ—¥å¼é¢¨å‘³å¾¡è†³<br>â—ä¸‹åˆï¼šç®±æ ¹ç¥ç¤¾æ°´ä¸Šé³¥å±… â†’ æ–°å€‰å±±æ·ºé–“å…¬åœ’äº”é‡å¡”ï¼Œæ¬£è³å¯Œå£«å±±çµ•æ™¯<br>â—æ™šä¸Šï¼šå…¥ä½ã€å¯Œå£«ç¾è¯RESORTã€‘æº«æ³‰é£¯åº—ï¼Œäº«ç™¾åŒ¯è‡ªåŠ©æˆ–è¿è³“æº«æ³‰æœƒå¸­æ–™ç†`,
            3: `ğŸ—“ ç¬¬ 3 å¤©ï½œ11/14ï¼ˆäº”ï¼‰ æ¸…é‡Œé«˜åŸ â†’ èŒæœ¨ä¹‹æ‘ â†’ è¼•äº•æ¾¤<br>â—æ—©ä¸Šï¼šé£¯åº—æ—©é¤ â†’ æ¸…é‡Œé«˜åŸ â†’ æ¸…æ³‰å¯®ï¼ˆè´ˆç‰›å¥¶å†°æ·‡æ·‹ã€è¶³æ¹¯ï¼‰<br>â—ä¸­åˆï¼šäº«ç”¨è¼•äº•æ¾¤é‡œé£¯å®šé£Ÿæˆ–æ—¥å¼é¤<br>â—ä¸‹åˆï¼šã€èŒæœ¨ä¹‹æ‘ã€‘ç«¥è©±æ£®æ— â†’ è¼•äº•æ¾¤éŠ€åº§é€š â†’ è–ä¿ç¾…æ•™å ‚<br>â—æ™šä¸Šï¼šå…¥ä½ã€è¼•äº•æ¾¤GREEN PLAZAã€‘æº«æ³‰é£¯åº—ï¼Œäº«ç™¾åŒ¯è‡ªåŠ©æˆ–è¿è³“æº«æ³‰æœƒå¸­æ–™ç†`,
            4: `ğŸ—“ ç¬¬ 4 å¤©ï½œ11/15ï¼ˆå…­ï¼‰ ç™½çµ²ç€‘å¸ƒ â†’ å·è¶Šå°æ±Ÿæˆ¶ â†’ å°å ´<br>â—æ—©ä¸Šï¼šé£¯åº—æ—©é¤ â†’ ã€ç™½çµ²ç€‘å¸ƒã€‘è¼•äº•æ¾¤ç§˜å¢ƒ<br>â—ä¸­åˆï¼šã€å·è¶Šå°æ±Ÿæˆ¶ã€‘æ™‚ä¹‹é˜ã€è“å­å±‹æ©«ä¸ â†’ åˆé¤æ—¥å¼å¥—é¤<br>â—ä¸‹åˆï¼šå…ç¨…åº— â†’ ã€å°å ´è³¼ç‰©å»£å ´ã€‘è‡ªç”±è³¼ç‰©<br>â—æ™šä¸Šï¼šè‡ªç”±è¦“é£Ÿï¼ˆè‡ªç†ï¼‰ â†’ å…¥ä½ã€T-MARK CITYæ±äº¬å¤§æ£®ã€‘é£¯åº—`,
            5: `ğŸ—“ ç¬¬ 5 å¤©ï½œ11/16ï¼ˆæ—¥ï¼‰ Outlet â†’ æˆç”° âœˆ æ¡ƒåœ’<br>â—æ—©ä¸Šï¼šé£¯åº—æ—©é¤ â†’ ã€MITSUI OUTLET å¹•å¼µã€‘æˆ–ã€é…’é…’äº• PREMIUM OUTLETSã€‘è³¼ç‰©<br>â—ä¸­åˆï¼šè‡ªç”±ç”¨é¤ï¼ˆè‡ªç†ï¼‰<br>â—ä¸‹åˆï¼šå‰å¾€æˆç”°æ©Ÿå ´ â†’ åœ‹æ³° CX451 (15:20 â†’ 18:40)<br>â—æ™šä¸Šï¼šæŠµé”æ¡ƒåœ’ï¼Œè¿”å›æº«æš–çš„å®¶`
        };

        // è¡Œç¨‹è³‡æ–™ (ä¿æŒä¸è®Š)
        const itinerary = [
            { title: "æŠµé”æ±äº¬æˆç”°æ©Ÿå ´ï¼ˆNRTï¼‰", coords: [35.764722, 140.386389], note: "è¾¦ç†ç™»æ©Ÿæ‰‹çºŒï¼Œæ­ä¹˜åœ‹æ³° CX450 (12:50 â†’ 16:50)æŠµé”æ—¥æœ¬ã€‚", label: "âœˆï¸", day: 1 },
            { title: "æ±äº¬æ¹¯æ¨‚åŸ", coords: [35.7925, 140.297], note: "æŠµé”æˆç”°å¾Œå°ˆè»Šå‰å¾€ã€‚æº«æ³‰ä¸»é¡Œæ¨‚åœ’ï¼ˆå²©ç›¤æµ´ã€è¡—æ™¯ã€è²å…‰ç§€ï¼‰ï¼Œä¸¦å…¥ä½æ¹¯æ¨‚åŸåœ‹éš›æ¸¡å‡é…’åº—ã€‚", label: "1", day: 1 },
            { title: "éŒå€‰é«˜æ ¡å‰", coords: [35.305717, 139.485124], note: "é«”é©—æ¹˜å—æµ·å²¸ã€æ±Ÿä¹‹å³¶é›»è»Šé«”é©—ã€‘ã€éŒå€‰é«˜æ ¡å‰ï¼ˆçŒç±ƒé«˜æ‰‹æ‰“å¡ï¼‰ã€‚", label: "2", day: 2 },
            { title: "ç®±æ ¹ç¥ç¤¾", coords: [35.205739, 139.027061], note: "æ¬£è³ç®±æ ¹ç¥ç¤¾æ°´ä¸Šé³¥å±…ï¼Œæ¢è¨ªæ­·å²å¤å‰ã€‚", label: "3", day: 2 },
            { title: "æ–°å€‰å±±æ·ºé–“å…¬åœ’", coords: [35.50348, 138.80211], note: "æ–°å€‰å±±æ·ºé–“å…¬åœ’äº”é‡å¡”ï¼Œæ¬£è³å¯Œå£«å±±çµ•æ™¯ã€‚æ™šä¸Šå…¥ä½å¯Œå£«ç¾è¯RESORTæº«æ³‰é£¯åº—ã€‚", label: "4", day: 2 },
            { title: "æ¸…é‡Œé«˜åŸèˆ‡æ¸…æ³‰å¯®", coords: [35.9189, 138.4414], note: "æŠµé”æ¸…é‡Œé«˜åŸï¼Œå‰å¾€æ¸…æ³‰å¯®ï¼ˆè´ˆé€ç‰›å¥¶å†°æ·‡æ·‹ã€è¶³æ¹¯ï¼‰ã€‚", label: "5", day: 3 },
            { title: "èŒæœ¨ä¹‹æ‘", coords: [35.908, 138.432], note: "å‰å¾€ã€èŒæœ¨ä¹‹æ‘ã€‘ç«¥è©±æ£®æ—ï¼Œäº«å—æ‚ é–’æ™‚å…‰ã€‚", label: "6", day: 3 },
            { title: "è¼•äº•æ¾¤èˆŠéŠ€åº§é€šèˆ‡è–ä¿ç¾…æ•™å ‚", coords: [36.3533, 138.6366], note: "é€›è¼•äº•æ¾¤éŠ€åº§é€šï¼Œä¸¦åƒè§€è–ä¿ç¾…æ•™å ‚ã€‚æ™šä¸Šå…¥ä½è¼•äº•æ¾¤GREEN PLAZAæº«æ³‰é£¯åº—ã€‚", label: "7", day: 3 },
            { title: "ç™½çµ²ç€‘å¸ƒ", coords: [36.3779, 138.5463], note: "æ¢ç´¢è¼•äº•æ¾¤ç§˜å¢ƒã€ç™½çµ²ç€‘å¸ƒã€‘ã€‚", label: "8", day: 4 },
            { title: "å·è¶Šå°æ±Ÿæˆ¶æ‡·å¤è¡—é“", coords: [35.9242, 139.4828], note: "å‰å¾€ã€å·è¶Šå°æ±Ÿæˆ¶ã€‘æ‡·å¤è¡—é“ï¼Œåƒè§€æ™‚ä¹‹é˜ã€è“å­å±‹æ©«ä¸ã€‚", label: "9", day: 4 },
            { title: "å°å ´è³¼ç‰©å»£å ´", coords: [35.6253, 139.7797], note: "ä¸‹åˆå‰å¾€å…ç¨…åº—ï¼Œä¹‹å¾Œå‰å¾€ã€å°å ´è³¼ç‰©å»£å ´ã€‘è‡ªç”±è³¼ç‰©ã€‚æ™šä¸Šå…¥ä½T-MARK CITYæ±äº¬å¤§æ£®é£¯åº—ã€‚", label: "10", day: 4 },
            { title: "é…’é…’äº•PREMIUM OUTLETS", coords: [35.7538, 140.2796], note: "æ—©ä¸Šåœ¨ã€MITSUI OUTLET å¹•å¼µã€‘æˆ–ã€é…’é…’äº• PREMIUM OUTLETSã€‘äº«å—è³¼ç‰©æ¨‚è¶£ã€‚", label: "11", day: 5 },
            { title: "é›¢é–‹æ±äº¬æˆç”°æ©Ÿå ´ï¼ˆNRTï¼‰", coords: [35.764722, 140.386389], note: "ä¸‹åˆå‰å¾€æˆç”°æ©Ÿå ´ï¼Œæ­ä¹˜åœ‹æ³° CX451 (15:20 â†’ 18:40)è¿”å›æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ã€‚", label: "âœˆï¸", day: 5 }
        ];

        // æ–°å¢é£¯åº—æ¸…å–®è³‡æ–™ - åŒ…å« lat/lon åº§æ¨™
        const hotelData = [
            // é£¯åº—åº§æ¨™ç”¨æ–¼åœ°åœ–ä¸­å¿ƒåŒ–ï¼Œè«‹ç¢ºä¿é€™äº›åº§æ¨™æ˜¯æº–ç¢ºçš„
            { day: 1, name: "æ¹¯æ¨‚åŸåœ‹éš›æ¸¡å‡é…’åº—", lat: 35.7937, lon: 140.3015 }, // é ä¼°æˆç”°æ©Ÿå ´é™„è¿‘åº§æ¨™
            { day: 2, name: "å¯Œå£«ç¾è¯RESORT", lat: 35.48938, lon: 138.8066 }, // é ä¼°å¯Œå£«å±±/æ²³å£æ¹–é™„è¿‘åº§æ¨™
            { day: 3, name: "è¼•äº•æ¾¤GREEN PLAZA", lat: 36.4253, lon: 138.5605 }, // é ä¼°è¼•äº•æ¾¤é™„è¿‘åº§æ¨™
            { day: 4, name: "Tmark City Hotel æ±äº¬å¤§æ£®", lat: 35.5898, lon: 139.7344 } // é ä¼°å¤§æ£®é™„è¿‘åº§æ¨™
        ];

        // é¡è‰²æ˜ å°„
        const dayColors = { 1:'#2e8b57', 2:'#d62828', 3:'#f77f00', 4:'#fcbf49', 5:'#555555' };

        // ç‹€æ…‹
        let currentItineraryIndex = 0;
        let markers = [];
        let bounds;

        /**
         * è®“æŒ‡å®šåº§æ¨™åœ¨é¡é ­ä¸­è½åœ¨ã€Œè¢å¹•ä¸‹æ–¹ã€è·åº•éƒ¨ marginBottom åƒç´ ã€çš„ä½ç½®
         */
        function flyToPinNearBottom(latlng, zoom = 12, marginBottom = BOTTOM_SAFE_MARGIN) {
            const size = map.getSize();
            const point = map.project(latlng, zoom);
            const offset = L.point(0, (size.y / 2) - marginBottom);
            const targetPoint = point.subtract(offset);
            const targetLatLng = map.unproject(targetPoint, zoom);
            map.flyTo(targetLatLng, zoom, { animate: true, duration: 0.8 });
        }

        /**
         * æ›´æ–°å ´æ™¯é¡¯ç¤º
         */
        function updateSceneDisplay(index) {
            const total = itinerary.length;
            if (index < 0) index = total - 1;
            if (index >= total) index = 0;

            currentItineraryIndex = index;
            if (!markers[currentItineraryIndex]) {
                console.error("Marker not found at index:", currentItineraryIndex);
                return;
            }

            const item = itinerary[currentItineraryIndex];
            const marker = markers[currentItineraryIndex];

            // è®“é»é ä¸‹ï¼ˆç•™ 200px å®‰å…¨è·é›¢ï¼‰
            flyToPinNearBottom(item.coords, 12);

            map.closePopup();
            marker.openPopup();
        }

        function nextScene() { updateSceneDisplay(currentItineraryIndex + 1); }
        function prevScene() { updateSceneDisplay(currentItineraryIndex - 1); }

        /**
         * é¡¯ç¤ºæ‰€æœ‰æ™¯é»ï¼ˆå…¨è¦½æ™‚ä¹Ÿç•™å‡ºåº•éƒ¨ç©ºé–“ï¼‰
         */
        function showAllScenes() {
            map.closePopup();
            map.fitBounds(bounds, {
                paddingTopLeft: [50, 50],
                paddingBottomRight: [50, BOTTOM_SAFE_MARGIN + 20] // 220px
            });
        }

        // ===============================================
        // é£¯åº—æ¸…å–®ç›¸é—œåŠŸèƒ½
        // ===============================================

        /**
         * å‰µå»º Google Maps é€£çµï¼Œä½¿ç”¨é—œéµå­—æŸ¥è©¢æ ¼å¼ï¼Œä¸¦ä»¥åº§æ¨™ç²¾ç¢ºå®šä½ä¸­å¿ƒé»ã€‚
         * é€éåº§æ¨™å¼·åˆ¶å®šä½ï¼Œè§£æ±ºä¸€èˆ¬æœå°‹ä¸ç²¾ç¢ºçš„å•é¡Œã€‚
         * @param {string} hotelName - é£¯åº—åç¨± (å°‡æœƒè¢«ç´å…¥ URL æœå°‹è©ï¼Œä»¥é–å®šåœ°å€)ã€‚
         * @param {number} lat - é£¯åº—ç·¯åº¦ã€‚
         * @param {number} lon - é£¯åº—ç¶“åº¦ã€‚
         * @returns {string} Google Maps æœå°‹ URLã€‚
         */
        function createGoogleMapsSearchUrl(hotelName, lat, lon) {
            // *** ä¿®æ­£ï¼šå°‡é£¯åº—åç¨±å’Œåœ‹å®¶åç¨±åŠ å…¥æŸ¥è©¢å­—ä¸²ï¼Œä»¥å…‹æœ IP å®šä½åå·® ***
            // æŸ¥è©¢é—œéµå­—ï¼šè¶…å¸‚ ç¾é£Ÿ near [é£¯åº—åç¨±] æ—¥æœ¬
            const fullQuery = `è¶…å¸‚ ç¾é£Ÿ near ${hotelName} æ—¥æœ¬`;
            const encodedQuery = encodeURIComponent(fullQuery);
            // çµæ§‹ï¼šhttps://www.google.com/maps/search/[EncodedQuery]/@[lat],[lon],[zoom]z
            // 15z æ˜¯åˆé©çš„ç¸®æ”¾ç´šåˆ¥ï¼Œå¼·åˆ¶ Google ä»¥æ­¤åæ¨™ç‚ºä¸­å¿ƒé€²è¡Œæœç´¢
            return `https://www.google.com/maps/search/${encodedQuery}/@${lat},${lon},15z`;
        }
        
        /**
         * å‰µå»º Google Maps é€£çµï¼Œç”¨æ–¼é¡¯ç¤ºé£¯åº—ç²¾ç¢ºä½ç½®ã€‚
         * @param {number} lat - é£¯åº—ç·¯åº¦ã€‚
         * @param {number} lon - é£¯åº—ç¶“åº¦ã€‚
         * @returns {string} Google Maps URLã€‚
         */
        function createGoogleMapsHotelUrl(lat, lon) {
            // ä½¿ç”¨åº§æ¨™å®šä½ï¼Œä¸¦çµ¦äºˆä¸€å€‹æ¨™è¨˜
            // çµæ§‹ï¼šhttps://www.google.com/maps/search/?api=1&query=[lat],[lon]
            return `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
        }

        /**
         * é—œé–‰é£¯åº—æ¸…å–®å½ˆçª—
         */
        function closeHotelListModal() {
            document.getElementById('hotel-modal').style.display = 'none';
        }

        /**
         * æ‰“é–‹é£¯åº—æ¸…å–®å½ˆçª—
         */
        function openHotelListModal() {
            const modal = document.getElementById('hotel-modal');
            const listContainer = document.getElementById('hotel-list-content');
            listContainer.innerHTML = ''; // æ¸…ç©ºèˆŠå…§å®¹

            // èª¿æ•´: ç§»é™¤ currentDay åˆ¤æ–·ï¼Œç›´æ¥åˆä½µå¤©æ•¸å’Œé£¯åº—åç¨±åˆ° h3 æ¨™é¡Œä¸­
            hotelData.forEach(item => {
                // 1. åˆä½µå¤©æ•¸å’Œé£¯åº—åç¨±åˆ°å–®è¡Œ h3 æ¨™é¡Œ
                const combinedHeader = document.createElement('h3');
                combinedHeader.textContent = `ç¬¬ ${item.day} å¤© - ${item.name}`;
                listContainer.appendChild(combinedHeader);

                const buttonGroup = document.createElement('div');
                buttonGroup.className = 'button-group'; // æŒ‰éˆ•çµ„å®¹å™¨

                // 2. æœå°‹å‘¨é‚Šè¶…å¸‚/ç¾é£Ÿ æŒ‰éˆ• (ç§»é™¤ (Google))
                const searchButton = document.createElement('button');
                searchButton.className = 'hotel-link-button hotel-search-button';
                searchButton.innerHTML = 'ğŸ” å‘¨é‚Šè¶…å¸‚/ç¾é£Ÿ'; // (Google) å·²ç§»é™¤
                searchButton.title = `ä½¿ç”¨ Google æœå°‹ ${item.name} é™„è¿‘è¶…å¸‚åŠç¾é£Ÿ (ä»¥åº§æ¨™å®šä½)`;
                
                searchButton.onclick = () => {
                    if (item.lat && item.lon) {
                        // ä½¿ç”¨æ–°çš„å‡½å¼ï¼ŒåŒ…å«é£¯åº—åç¨±å’Œåœ‹å®¶
                        const url = createGoogleMapsSearchUrl(item.name, item.lat, item.lon);
                        window.open(url, '_blank'); // åœ¨æ–°åˆ†é é–‹å•Ÿ
                    } else {
                        console.error("Missing coordinates for hotel:", item.name);
                    }
                    // ä¸é—œé–‰å½ˆçª—ï¼Œæ–¹ä¾¿ç”¨æˆ¶ç¹¼çºŒæ“ä½œ
                };
                buttonGroup.appendChild(searchButton);

                // 2. é¡¯ç¤ºé£¯åº—åœ°åœ–ä½ç½® æŒ‰éˆ• (ç§»é™¤ (Google åœ°åœ–))
                const showButton = document.createElement('button');
                showButton.className = 'hotel-link-button hotel-show-button';
                showButton.innerHTML = 'ğŸ“ é¡¯ç¤ºé£¯åº—'; // (Google åœ°åœ–) å·²ç§»é™¤
                showButton.title = `åœ¨ Google åœ°åœ–ä¸Šé¡¯ç¤º ${item.name} çš„ç¢ºåˆ‡ä½ç½®`;
                
                showButton.onclick = () => {
                    if (item.lat && item.lon) {
                        const url = createGoogleMapsHotelUrl(item.lat, item.lon);
                        window.open(url, '_blank'); // åœ¨æ–°åˆ†é é–‹å•Ÿ
                    } else {
                        console.error("Missing coordinates for hotel:", item.name);
                    }
                    // ä¸é—œé–‰å½ˆçª—
                };
                buttonGroup.appendChild(showButton);
                
                listContainer.appendChild(buttonGroup);
                
                // æ·»åŠ åˆ†éš”ç·š (é™¤äº†æœ€å¾Œä¸€å€‹å…ƒç´ )
                if (item.day < hotelData[hotelData.length - 1].day) {
                    listContainer.appendChild(document.createElement('hr'));
                }
            });

            modal.style.display = 'block';
        }


        // å»ºç«‹æ¨™è¨˜èˆ‡è·¯ç·š (ä¿æŒä¸è®Š)
        let polylinePoints = [];
        itinerary.forEach(function(item, index) {
            const popupContent = `
            <div class="custom-popup">
                <h2 class="leaflet-popup-header">ç¬¬ ${item.day} å¤©ï¼š${item.title}</h2>
                ${item.note ? `<p class="scene-note-content"><b>æ™¯é»å‚™è¨»ï¼š</b> ${item.note}</p><hr>` : ''}
                <p class="itinerary-content"><b>ç•¶æ—¥å®Œæ•´è¡Œç¨‹ï¼š</b><br>${fullItineraries[item.day]}</p>
            </div>`;
            const isEmoji = isNaN(item.label);
            const labelClass = isEmoji ? 'emoji-label' : '';

            const marker = L.marker(item.coords, {
                icon: L.divIcon({
                    className: `my-div-icon day-${item.day}-icon`,
                    html: `<span class="${labelClass}">${item.label}</span>`
                })
            }).bindPopup(popupContent).addTo(map);

            markers.push(marker);
            polylinePoints.push({ coords: item.coords, day: item.day });

            marker.on('click', function() { updateSceneDisplay(index); });
        });

        // å¤šè‰²è·¯ç·š (ä¿æŒä¸è®Š)
        let currentDayPoints = [];
        for (let i = 0; i < polylinePoints.length; i++) {
            currentDayPoints.push(polylinePoints[i].coords);
            if (i < polylinePoints.length - 1 && polylinePoints[i].day !== polylinePoints[i+1].day) {
                L.polyline(currentDayPoints, { color: dayColors[polylinePoints[i].day], weight: 5 }).addTo(map);
                currentDayPoints = [polylinePoints[i].coords];
            }
        }
        L.polyline(currentDayPoints, { color: dayColors[polylinePoints[polylinePoints.length-1].day], weight: 5 }).addTo(map);

        // å…¨è¦½é‚Šç•Œï¼ˆåˆå§‹ä¹Ÿç•™åº•éƒ¨ç©ºé–“ï¼‰
        bounds = L.latLngBounds(polylinePoints.map(p => p.coords));
        map.fitBounds(bounds, {
            paddingTopLeft: [50, 50],
            paddingBottomRight: [50, BOTTOM_SAFE_MARGIN + 20] // 220px
        });

        // æ§åˆ¶é …èˆ‡äº‹ä»¶
        window.onload = function() {
            L.control.zoom({ position: 'bottomright' }).addTo(map);
            L.control.scale({ imperial: false }).addTo(map);

            if (typeof L.control.mousePosition === 'function') {
                L.control.mousePosition({ position: 'bottomleft', separator: 'ï¼Œ', prefix: 'åº§æ¨™ï¼š' }).addTo(map);
            } else {
                console.warn("Leaflet MousePosition plugin failed to initialize.");
            }

            // ç¶å®šäº‹ä»¶ç›£è½å™¨
            document.getElementById('prev-scene-button')?.addEventListener('click', prevScene);
            document.getElementById('next-scene-button')?.addEventListener('click', nextScene);
            document.getElementById('show-all-button')?.addEventListener('click', showAllScenes);
            document.getElementById('hotel-list-button')?.addEventListener('click', openHotelListModal); // æ–°å¢çš„æŒ‰éˆ•äº‹ä»¶

            // é»æ“Šå½ˆçª—å¤–éƒ¨é—œé–‰
            const modal = document.getElementById('hotel-modal');
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    closeHotelListModal();
                }
            });

            if (markers.length > 0) updateSceneDisplay(0);
        };
    </script>
</body>
</html>
